<!DOCTYPE html>
<html lang="en">
<head>
    <title>Patterns in the Void - linux thread injection</title>
    <meta charset="utf-8" />
    <meta name="robots" 
          content="noindex, nofollow">
    <link rel="stylesheet" 
          href="https://blog.patternsinthevoid.net/theme/css/main.css" 
          type="text/css" />
        <link href="https://blog.patternsinthevoid.net/feeds/all.atom.xml" 
          type="application/atom+xml" 
          rel="alternate" 
          title="Patterns in the Void Atom Feed" />
                <link href="https://blog.patternsinthevoid.net/theme/prettify/prettify.css"
          type="text/css"
          rel="stylesheet" />
    <script type="text/javascript" 
            src="https://blog.patternsinthevoid.net/theme/prettify/prettify.js"></script>
        <noscript>
        <div style="width:80%;">
        <p style="line-height:90%;margin:10px 10px 0px 10px;text-align:justify;text-indent:25px;">
            <small>
            <br>Hey, kudos! You don't run arbitrary scripts either!<br />
            <br>My apologies for the javascript on this page...it's 
            prettify.js for the syntax highlighting in code blocks. 
            I added
            <a href="https://blog.patternsinthevoid.net/theme/prettify/nope.css">one line of CSS</a>
            for you; the rest of this site should work fine.<br />
            <br>&#x24B6;&#38;&#x2665; isis<br /></small>
        </p>
        </div>
        <link href="https://blog.patternsinthevoid.net/theme/prettify/nope.css"
              type="text/css"
              rel="stylesheet" />
    </noscript>

    <!--[if IE]>
        <script src="https://blog.patternsinthevoid.net/theme/js/html5.js">
        </script>
        <![endif]-->

    <!--[if lte IE 7]>
        <link rel="stylesheet" type="text/css" media="all"
              href="https://blog.patternsinthevoid.net/theme/css/ie.css"/>
        <script src="https://blog.patternsinthevoid.net/theme/js/IE8.js"
                type="text/javascript"></script>
        <![endif]-->

    <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" media="all"
              href="https://blog.patternsinthevoid.net/theme/css/ie6.css"/>
        <![endif]-->
</head>

<body id="index" class="home" onload="prettyPrint()">
<a href="https://github.com/isislovecruft">
        <img style="position: absolute; top: 0; right: 0; border: 0; max-width: 48px;"
         src="https://blog.patternsinthevoid.net/theme/images/icons/github-tentacle-icon.png"
         alt="code." />
</a>
<header id="banner" class="body">
    <h1>
        <a href="https://blog.patternsinthevoid.net/">Patterns in the Void 
                    </a>
    </h1>
    <nav>
        <ul>
                                                            <li >
                <a href="https://blog.patternsinthevoid.net/category/anarchism.html">anarchism</a>
            </li>
                                                                        <li >
                <a href="https://blog.patternsinthevoid.net/category/hacking.html">hacking</a>
            </li>
                                                <li >
                <a href="https://blog.patternsinthevoid.net/category/physics.html">physics</a>
            </li>
                                                <li >
                <a href="https://blog.patternsinthevoid.net/category/travel.html">travel</a>
            </li>
                                </ul>
    </nav>
</header>

<!-- /#banner -->
        
        

<aside id="featured" class="body">
    <article>
        <h1 class="entry-title"><a href="https://blog.patternsinthevoid.net/defcon-report-back-part-1.html">Defcon Report Back, Part&nbsp;1</a></h1> 
        <footer class="post-info">
        <abbr class="published" title="2011-08-08T23:59:00">
                Monday, 08 August 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="https://blog.patternsinthevoid.net/author/isis-agora-lovecruft.html">isis agora lovecruft</a>
        </address>
        <p>In <a href="https://blog.patternsinthevoid.net/category/hacking.html">hacking</a> </p>
<p>tags: <a href="https://blog.patternsinthevoid.net/tag/assembly-languages.html">assembly languages </a><a href="https://blog.patternsinthevoid.net/tag/defcon.html">Defcon </a><a href="https://blog.patternsinthevoid.net/tag/javascript.html">javascript </a><a href="https://blog.patternsinthevoid.net/tag/jugaad.html">jugaad </a><a href="https://blog.patternsinthevoid.net/tag/kernel-exploitation.html">Kernel Exploitation </a><a href="https://blog.patternsinthevoid.net/tag/las-vegas.html">las vegas </a><a href="https://blog.patternsinthevoid.net/tag/libhijack.html">libhijack </a><a href="https://blog.patternsinthevoid.net/tag/linux-thread-injection.html">linux thread injection </a><a href="https://blog.patternsinthevoid.net/tag/malicious-pdf.html">malicious pdf </a><a href="https://blog.patternsinthevoid.net/tag/mmap-syscall.html">mmap syscall </a><a href="https://blog.patternsinthevoid.net/tag/port-scan.html">port scan </a><a href="https://blog.patternsinthevoid.net/tag/ptrace.html">ptrace </a><a href="https://blog.patternsinthevoid.net/tag/python.html">python </a><a href="https://blog.patternsinthevoid.net/tag/runtime-process-library-injection.html">runtime process library injection </a><a href="https://blog.patternsinthevoid.net/tag/shellcode.html">shellcode </a><a href="https://blog.patternsinthevoid.net/tag/sptrace.html">sptrace </a><a href="https://blog.patternsinthevoid.net/tag/strace.html">strace </a><a href="https://blog.patternsinthevoid.net/tag/umap.html">Umap </a><a href="https://blog.patternsinthevoid.net/tag/upnp.html">UPnP </a></p>
</footer><!-- /.post-info --><p>Friday 5^th^ August 2011, Defcon 19, Las&nbsp;Vegas</p>
<h2>Analyzing Embedded Malicious Code in&nbsp;PDFs</h2>
<p>So, the first was Mahmud Ab Rahman&#8217;s presentation <a href="www.giac.org/paper/gpen/3418/malicious-pdf-analysis/121349">on parsing and
analyzing malacious code embedded in .pdfs</a>. I can&#8217;t guarantee that
paper doesn&#8217;t have anything malicious embedded. But I have used a .pdf
parser written in python by <a href="https://DidierStevens.com">Didier Stevens</a> and been very confused
about .pdf code structure, so Ab Rahman&#8217;s Sneaky <span class="caps">PDF</span> lecture was highly
enlightening. I can&#8217;t find video for that presentation up yet, but that
.pdf above does contain everything said and the original slides.
Basically, malicious .pdfs use JavaScript code obfuscation through
spaghetti code, infinite loops, misdirected object references, code
encryption, and media-rich embedded objects such as flash videos or
audio files. Ab Rahman gave a few lists of tools which he used to better
parse and de-obfuscate: tools such as <a href="https://developer.mozilla.org/en/SpiderMonkey">SpiderMonkey</a>, <a href="https://www.mozilla.org/rhino/">Rhino</a>,
<a href="https://code.google.com/p/v8/">V8</a>, and <a href="http://jsbeautifier.org/">JSBeautifier</a> can all be used to fix spaghetti code,
infinite loops, and misdirected object references, and tools like
<a href="www.unixuser.org/~euske/python/pdfminer/">PDFminer</a>, <a href="https://gallus.honeynet.org.my/">Gallus</a>, <a href="http://news.wepawet.cs.ucsb.edu/">Wepawet</a>, <a href="http://aptdeezer.xecure-lab.com/">APTdeezer</a>, and <a href="http://esec-lab.sogeti.com/pages/Origami">Origami</a>
can be used in addition to Didier Steven&#8217;s above referenced tool for
parsing. Also, I found <a href="http://www.decalage.info/file_formats_security/pdf">an entire site on <span class="caps">PDF</span> security issues</a>, with
lists of relevant tools and white papers which go into more detail on
obfuscation and detection&nbsp;methods.</p>
<h2>Linux Thread&nbsp;Injection</h2>
<p>Aseem “@” Jakhar presented on <a href="http://null.co.in/section/atheneum/projects/">Jugaad</a>, a newly released Linux Thread
Injection kit, which uses the <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Ptrace">ptrace() function</a> in <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Gdb">gdb</a> to inject
arbitrary code into running processes. <a href="http://good.net/dl/k4r3lj/DEFCON19/DEFCON-19-Jakhar-Jugaad-Linux-Thread-Injection.pdf">Here&#8217;s the pdf</a> of his
presentation, and <a href="http://www.slideshare.net/null0x00/project-jugaad">here&#8217;s the slides</a> from slideshare. The<a href="http://www.devshed.com/c/a/BrainDump/The-MMAP-System-Call-in-Linux/">mmap
syscall</a> was used to produce shellcode in hex from assembly for
payload creation. (If this sounds like jibberish, you might want to
learn about <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Shellcode">what shellcode is</a> and <a href="http://www.vividmachines.com/shellcode/shellcode.html">how to write shellcode</a>, which
is going to include <a href="http://homepage.mac.com/randyhyde/webster.cs.ucr.edu/index.html">learning assembly languages</a>.) It&#8217;s essentially
the Linux equivalent of the Windows malware <a href="http://www.codeproject.com/KB/threads/completeinject.aspx">CreateRemoteThread()
<span class="caps">API</span></a>, and Jugaad provides all the functionality and ease-of-use as its
Windows cousin. All the more reason to <a href="http://freshmeat.net/projects/sptrace">disable ptrace()
functionality</a> on boxes which are not being actively used in
production environments, or use sptrace() to limit user access to that&nbsp;functionality.</p>
<h2>Runtime Process Library&nbsp;Injection</h2>
<p>Along a similar line,<a href="http://0xfeedface.org/users/lattera">Shawn Webb</a> talked about<a href="http://good.net/dl/k4r3lj/DEFCON19/DEFCON-19-Webb-Runtime-Process-Insemination.pdf">runtime process
insemination</a> (click for pdf) using his also newly released tool,
<a href="http://0xfeedface.org/category/tags/libhijack">Libhijack</a>, to anonymously inject shared objects and libraries in as
little as eight lines of C code, with little to no physical evidence
left&nbsp;behind.</p>
<h2>UPnP&nbsp;Mapping</h2>
<p>There was a <a href="http://good.net/dl/k4r3lj/DEFCON19/DEFCON-19-Garcia-UPnP-Mapping.pdf">presentation on Universal Plug-and-Play (UPnP) device
mapping</a> by Daniel Garcia. Most of what I took from that was that
Garcia&#8217;s Umap scanner allows mapping of hosts behind the device <span class="caps">NAT</span>,
SOCKv4 proxying, and manual port-mapping from <span class="caps">LAN</span> to <span class="caps">WAN</span> and vice versa.
This allows masking of <span class="caps">IP</span> addresses and attacking non-outward facing
hosts within an internal network. Garcia released a new tool, <a href="http://packetstormsecurity.org/files/90598/Umap-UPNP-Map-0.1beta.html">Umap</a>,
which scans <span class="caps">TCP</span> for open ports behind UPnP enabled Internet Gateway&nbsp;Devices.</p>
<h2>Kernel&nbsp;Exploitation</h2>
<p>Next up was Kees Cook, head of security at Ubuntu, presenting<a href="https://good.net/dl/k4r3lj/DEFCON19/DEFCON-19-Cook-Kernel-Exploitation.pdf">on Kernel
Exploitation</a>. I&#8217;ll admit this talk was a little above my head, and
I&#8217;m looking forward to going over notes on it and following the commands
in the slides more closely. It seemed like it was basically the same
thing as the ptrace() vulnerability, and there was something about grep
copy_from_user() without&nbsp;access_ok().</p>
<p>Update for the talks from Saturday and Sunday to&nbsp;follow!</p>    </article>
        <p class="paginator">
        Page 1 / 1
    </p>
    </aside><!-- /#featured -->
                                            </ol><!-- /#posts-list -->
                    </section><!-- /#content -->
                                <section id="extras" 
         class="body">
        <div class="blogroll">
        <h2>blogroll</h2>
        <ul>
                        <li><a href="https://fyb.patternsinthevoid.net">pelagus</a></li>
                        <li><a href="https://blog.patternsinthevoid.net/isis.txt">clavium apertum</a></li>
                        <li><a href="https://code.patternsinthevoid.net">codii et codicilli</a></li>
                        <li><a href="https://blog.patternsinthevoid.net/calendar.html">horologii</a></li>
                        <li><a href="https://blog.patternsinthevoid.net/pages/about-the-author.html">elogii biothanatum</a></li>
                        <li><a href="https://blog.patternsinthevoid.net/pages/libris.html">libris atricoloris</a></li>
                        <li><a href="https://image.patternsinthevoid.net">imaginis</a></li>
                        <li><a href="https://sound.patternsinthevoid.net">strepitus</a></li>
                    </ul>
    </div>
    <!-- /.blogroll -->
            <div class="social">
        <h2>social</h2>
        <ul>
            <li><a href="https://blog.patternsinthevoid.net/feeds/all.atom.xml" 
                   type="application/atom+xml" 
                   rel="alternate">atom feed</a>
            </li>
                        
                        <li><a href="https://twitter.com/#!/isislovecruft">twitter</a></li>
                        <li><a href="https://github.com/isislovecruft">github</a></li>
                        <li><a href="https://gs.torproject.org/user/isis">#tor-status</a></li>
                    </ul>
    </div><!-- /.social -->
    </section><!-- /#extras -->
<footer id="contentinfo" class="body" position="relative">
    <div style="height: 100%">
        <address id="about">
                <iframe src="//crypto.stanford.edu/flashproxy/embed.html" 
        width="80" height="15"
        frameborder="0" scrolling="no"
        accesskey="i"
        display="none"
        groove>
</iframe>
<div id="over">You're currently helping people in censored regions with <a href="https://crypto.stanford.edu/flashproxy/options.html">FlashProxy</a>. Thanks!</div>                </address><!-- /#about -->
    </div>
        <div style="font-size: 6px; text-align: center; position: right; padding: 2px 1px">
<table style="width: 15%;">
    <tr><td><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_GB"><img style="border-width:0" src="../theme/images/icons/cc-by-nc-sa.png" /></a>
<span property="dct:title" rel="dct:type"><a href="https://code.patternsinthevoid.net/">Patterns in the Void</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://blog.patternsinthevoid.net" property="cc:attributionName" rel="cc:attributionURL">Isis Agora Lovecruft</a> is licensed <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_GB">CC-BY-NC-SA</a>.</td></tr>
</table>
</div>    </footer><!-- /#contentinfo -->
</body>
</html>